<div class="card shadow-sm">
  <div class="card-body">
    <h2 class="h5 mb-3">Gesti√≥n de Empleados</h2>

    <!--  FORMULARIO -->
    <form (ngSubmit)="save()" autocomplete="off" novalidate>
      <div class="row g-3">
        <!-- Datos personales -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Nombre *</label>
          <input
            class="form-control"
            [(ngModel)]="model.nombre"
            name="nombre"
            required
            placeholder="Ej. Juan"
          />
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold">Apellido *</label>
          <input
            class="form-control"
            [(ngModel)]="model.apellido"
            name="apellido"
            required
            placeholder="Ej. P√©rez"
          />
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Sexo *</label>
          <select
            class="form-select"
            [(ngModel)]="model.sexo"
            name="sexo"
            required
          >
            <option value="" disabled>Seleccione</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">DPI *</label>
          <input
            class="form-control"
            [(ngModel)]="model.dpi"
            name="dpi"
            maxlength="25"
            required
            placeholder="Ej. 1234567890101"
          />
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Tel√©fono *</label>
          <input
            class="form-control"
            [(ngModel)]="model.telefono"
            name="telefono"
            maxlength="30"
            required
            placeholder="Ej. 5555-5555"
          />
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Correo *</label>
          <input
            class="form-control"
            type="email"
            [(ngModel)]="model.correo"
            name="correo"
            required
            placeholder="correo@ejemplo.com"
          />
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Fecha nacimiento *</label>
          <input
            class="form-control"
            type="date"
            [(ngModel)]="model.fecha_nacimiento"
            name="fecha_nacimiento"
            required
          />
        </div>

        <!-- Direcci√≥n -->
        <div class="col-md-4">
          <label class="form-label fw-semibold">Departamento</label>
          <select
            class="form-select"
            [(ngModel)]="model.idDepartamento"
            name="idDepartamento"
            (change)="onDepartamentoChange()"
          >
            <option [ngValue]="null">Seleccione...</option>
            <option *ngFor="let d of departamentos" [ngValue]="d.id">
              {{ d.nombre }}
            </option>
          </select>
        </div>

        <div class="col-md-5">
          <label class="form-label fw-semibold">Municipio *</label>
          <select
            class="form-select"
            [(ngModel)]="model.idMunicipio"
            name="idMunicipio"
            required
          >
            <option [ngValue]="null">Seleccione...</option>
            <option *ngFor="let m of municipios" [ngValue]="m.id">
              {{ m.nombre }}
            </option>
          </select>
        </div>

        <!-- Datos laborales -->
        <div class="col-md-8">
          <label class="form-label fw-semibold">Formaci√≥n acad√©mica *</label>
          <input
            class="form-control"
            [(ngModel)]="model.formacion_academica"
            name="formacion_academica"
            required
            placeholder="Ej. T√©cnico en Laboratorio Cl√≠nico"
          />
        </div>

        <div class="col-md-4">
          <label class="form-label fw-semibold">Estado *</label>
          <select
            class="form-select"
            [(ngModel)]="model.estado"
            name="estado"
            required
          >
            <option [ngValue]="1">Activo</option>
            <option [ngValue]="0">Inactivo</option>
          </select>
        </div>
      </div>

      <!-- Botones -->
      <div class="mt-3 d-flex justify-content-end gap-2">
        <button class="btn btn-primary" type="submit" [disabled]="loading">
          üíæ {{ editingId ? 'Actualizar' : 'Guardar' }}
        </button>
        <button class="btn btn-secondary" type="button" (click)="reset()">
          üßπ Nuevo
        </button>
      </div>

      <!-- Mensajes -->
      <div *ngIf="error" class="alert alert-danger mt-3">{{ error }}</div>
    </form>

    <hr class="my-4" />

    <!--  LISTADO -->
    <div *ngIf="loading" class="text-center text-muted my-3">
      <div class="spinner-border spinner-border-sm me-2 text-primary"></div>
      Cargando empleados...
    </div>

    <div class="table-responsive" *ngIf="!loading && items.length > 0">
      <table class="table table-sm table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Nombre completo</th>
            <th>Sexo</th>
            <th>DPI</th>
            <th>Tel√©fono</th>
            <th>Correo</th>
            <th>F. Nac.</th>
            <th>Municipio</th>
            <th>Formaci√≥n</th>
            <th>Estado</th>
            <th style="width: 120px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of items">
            <td>{{ r.id }}</td>
            <td>{{ r.nombre }} {{ r.apellido }}</td>
            <td>{{ r.sexo }}</td>
            <td>{{ r.dpi }}</td>
            <td>{{ r.telefono }}</td>
            <td>{{ r.correo }}</td>
            <td>{{ r.fecha_nacimiento | date: 'yyyy-MM-dd' }}</td>
            <td>{{ getMunicipioNombre(r.idMunicipio) }}</td>
            <td>{{ r.formacion_academica }}</td>
            <td>{{ r.estado === 1 ? 'Activo' : 'Inactivo' }}</td>
            <td class="text-center">
              <button
                class="btn btn-sm btn-outline-primary me-1"
                (click)="edit(r)"
                type="button"
              >
                ‚úèÔ∏è
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="remove(r.id)"
                type="button"
              >
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && items.length === 0" class="text-muted text-center">
      No hay empleados registrados.
    </div>
  </div>
</div>
