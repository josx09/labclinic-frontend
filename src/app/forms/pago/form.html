<div class="card shadow-sm">
  <div class="card-body">
    <h2 class="h5 mb-3">Pagos</h2>

    <!-- ==========================================================
         FORMULARIO DE EDICI√ìN DE PAGO (SIN CREACI√ìN MANUAL)
    ========================================================== -->
    <form (ngSubmit)="save()">
      <div class="row">
        <!-- Id Pago -->
        <div class="col-md-3 mb-2">
          <label class="form-label">Id Pago</label>
          <input class="form-control" type="number"
                 [(ngModel)]="model.id_pago"
                 name="id_pago" readonly>
        </div>

        <!-- Paciente -->
        <div class="col-md-9 mb-2">
          <label class="form-label">Paciente</label>
          <input class="form-control" type="text"
                 [(ngModel)]="model.paciente"
                 name="paciente" readonly>
        </div>

        <!-- Monto Pagado -->
        <div class="col-md-4 mb-2">
          <label class="form-label">Monto Pagado (Q)</label>
          <input class="form-control" type="number" step="0.01"
                 [(ngModel)]="model.monto_pagado"
                 name="monto_pagado"
                 [readonly]="!editingId"
                 required>
        </div>

        <!-- Concepto -->
        <div class="col-md-4 mb-2">
          <label class="form-label">Concepto</label>
          <input class="form-control" type="text"
                 [(ngModel)]="model.concepto"
                 name="concepto"
                 [readonly]="!editingId">
        </div>

        <!-- M√©todo de Pago -->
        <div class="col-md-4 mb-2">
          <label class="form-label">M√©todo de Pago</label>
          <select class="form-select"
                  [(ngModel)]="model.id_tipo_pago"
                  name="id_tipo_pago"
                  [disabled]="!editingId">
            <option [ngValue]="1">Efectivo</option>
            <option [ngValue]="2">Tarjeta</option>
            <option [ngValue]="3">Transferencia</option>
            <option [ngValue]="4">Otro</option>
          </select>
        </div>

        <!-- Fechas -->
        <div class="col-md-6 mb-2">
          <label class="form-label">Fecha Generado</label>
          <input class="form-control" type="datetime-local"
                 [(ngModel)]="model.fecha_generado"
                 name="fecha_generado" readonly>
        </div>

        <div class="col-md-6 mb-2">
          <label class="form-label">Fecha Pago</label>
          <input class="form-control" type="datetime-local"
                 [(ngModel)]="model.fecha_pago"
                 name="fecha_pago"
                 [readonly]="!editingId">
        </div>

        <!-- Nota -->
        <div class="col-md-8 mb-2">
          <label class="form-label">Nota</label>
          <input class="form-control" type="text"
                 [(ngModel)]="model.nota"
                 name="nota"
                 [readonly]="!editingId">
        </div>

        <!-- Estado -->
        <div class="col-md-4 mb-2">
          <label class="form-label">Estado</label>
          <select class="form-select"
                  [(ngModel)]="model.estado"
                  name="estado"
                  [disabled]="!editingId">
            <option [ngValue]="1">Activo</option>
            <option [ngValue]="0">Inactivo</option>
          </select>
        </div>
      </div>

      <!--  Mostrar bot√≥n Guardar solo en edici√≥n -->
      <div class="mt-3">
        <button *ngIf="editingId"
                class="btn btn-primary me-2"
                type="submit">
          üíæ Guardar cambios
        </button>
      </div>

      <div *ngIf="error" class="text-danger mt-2">{{ error }}</div>
    </form>

    <hr>

    <!-- ==========================================================
         LISTADO DE PAGOS REGISTRADOS
    ========================================================== -->
    <div *ngIf="loading">Cargando...</div>
    <div class="table-responsive" *ngIf="!loading">

      <div class="alert alert-info small">
        üí° Los pagos se generan autom√°ticamente desde el m√≥dulo de
        <strong>Ex√°menes</strong>. Aqu√≠ solo puede
        <strong>editar</strong> o <strong>eliminar</strong> los pagos existentes.
      </div>

      <table class="table table-sm table-striped align-middle">
        <thead>
          <tr>
            <th>Id Pago</th>
            <th>Paciente</th>
            <th>Tel√©fono</th>
            <th>Monto Pagado (Q)</th>
            <th>Concepto</th>
            <th>M√©todo de Pago</th>
            <th>Fecha Generado</th>
            <th>Fecha Pago</th>
            <th>Nota</th>
            <th>Estado</th>
            <th style="width:160px">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let r of items">
            <td>{{ r.id_pago }}</td>
            <td>{{ r.paciente }}</td>
            <td>{{ r.telefono }}</td>
            <td>{{ r.monto_pagado | number:'1.2-2' }}</td>
            <td>{{ r.concepto }}</td>
            <td>{{ r.tipo_pago_nombre }}</td>
            <td>{{ r.fecha_generado | date:'short' }}</td>
            <td>{{ r.fecha_pago | date:'short' }}</td>
            <td>{{ r.nota }}</td>
            <td>{{ r.estado }}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1"
                      (click)="edit(r)">‚úèÔ∏è Editar</button>
              <button class="btn btn-sm btn-danger"
                      (click)="delete(r)">üóë Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
